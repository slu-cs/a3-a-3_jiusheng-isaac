<!--Examples of editing the DOM-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Poll</title>
</head>
<body>
  <form>
    <h1 class="prompt">Enter a question:</h1>
    <input type="text" name="left">
    <button type="submit" class="submit">Submit</button>
  </form>
  <div class="poll"></div>
  <div class="vote"></div>
  <div class="result"></div>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script>
  /* Code from Todo exercise
  // Add to the to-do list
  $('form').on('submit', function(event) {
  event.preventDefault();

  // Grab the text and empty the box
  const input = $('input');
  const item = input.val();
  input.val('');

  // Add a non-empty item to the list
  if (item) {
  $('#placeholder').remove();
  $('ul').append($(`
  <li>
  <span>${item}</span>
  <button>Delete</button>
  </li>
  `));
}
});

// Delete from the to-do list
$('ul').on('click', 'button', function(event) {
$(this).closest('li').remove();

// Put back the placeholder if it's empty
const items = $('li');
if (items.length == 0) {
$('ul').append($('<li id="placeholder">Think of something to do!</li>'));
}
});
*/

let results = [];
let select = $('<select id="select" name="options"><option value="" selected disabled hidden>Choose</option></select>');

// Enter a question
$('form').on('submit', function(event) {
  const form = $(this); // JQuery object representing the form
  event.preventDefault(); // Don't really submit the form
  const input = $('input');
  const item = input.val();
  input.val('');
  $('form .prompt').replaceWith(`<h1 class="prompt">Enter answers for: ${item}</h1>`);
  $('form .submit').replaceWith('<button class="submit" id="submit">Submit</button>');
  $('form').append('<button id="done">Done</button>');

  // Add a non-empty item to the list
  if (item) {
    $('.poll').append($(`<h1 value="${item}">${item}</h1>`));
  }
});

// Enter answers for this question
$('form').on('click', '#submit', function(event) {
  const form = $(this); // JQuery object representing the form
  event.preventDefault(); // Don't really submit the form

  // Translate each input value into a list item
  const input = $('input');
  const item = input.val();
  input.val('');

  select.append($(`<option value="${item}">${item}</option>`))
  // Add to the page
  $('.poll').append(select);
});

// Poll finished
$('form').on('click', '#done', function(event) {
  const form = $(this); // JQuery object representing the form
  event.preventDefault(); // Don't really submit the form
  $('form').remove();
  $('.vote').append($('<button type="submit" id="vote">Vote</button>'));
});

// Voting
$('.vote').on('click', function(event) {
  const form = $(this); // JQuery object representing the form
  event.preventDefault(); // Don't really submit the form
  const selectedItem = $('#select').val();
  if (selectedItem) {
    results = getResult(results, selectedItem);
    if (!$('.result ul')[0]) $('.result').append($('<ul>Results</ul>'));
    $('.result li').remove();
    for (r of results) {
      $('.result ul').append($(`<li>${r.Option}: ${r.Counts}</li>`));
    }
  }
});

const getResult = function(arr, item) {
  for (let r of arr) {
    if (Object.is(r.Option, item)) {
      r.Counts++;
      return arr;
    }
  }
  arr.push({Option: $('#select').val(), Counts: 1});
  return arr;
};

</script>
</body>
</html>
